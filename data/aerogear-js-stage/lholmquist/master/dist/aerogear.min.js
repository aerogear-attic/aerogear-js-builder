/*! AeroGear JavaScript Library - v1.0.0.Alpha - 2012-10-24
* https://github.com/aerogear/aerogear-js
* JBoss, Home of Professional Open Source
* Copyright 2012, Red Hat, Inc., and individual contributors
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
* http://www.apache.org/licenses/LICENSE-2.0
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/
var AeroGear={};AeroGear.Core=function(){if(this instanceof AeroGear.Core)throw"Invalid instantiation of base class AeroGear.Core";this.add=function(e){var t,n,r=this[this.collectionName]||{};if(!e)return this;if(typeof e=="string")r[e]=AeroGear[this.lib].adapters[this.type](e);else if(AeroGear.isArray(e))for(t=0;t<e.length;t++)n=e[t],typeof n=="string"?r[n]=AeroGear[this.lib].adapters[this.type](n):r[n.name]=AeroGear[this.lib].adapters[n.type||this.type](n.name,n.settings||{});else r[e.name]=AeroGear[this.lib].adapters[e.type||this.type](e.name,e.settings||{});return this[this.collectionName]=r,this},this.remove=function(e){var t,n,r=this[this.collectionName]||{};if(typeof e=="string")delete r[e];else if(AeroGear.isArray(e))for(t=0;t<e.length;t++)n=e[t],typeof n=="string"?delete r[n]:delete r[n.name];else e&&delete r[e.name];return this[this.collectionName]=r,this}},function(e,t,n){e.Pipeline.adapters.Rest=function(t,n){if(!(this instanceof e.Pipeline.adapters.Rest))return new e.Pipeline.adapters.Rest(t,n);n=n||{};var r=n.endpoint||t,i={url:n.baseURL?n.baseURL+r:r},s=n.recordId||"id",o=n.authenticator||null,u="Rest";this.isAuthenticated=function(){return o?o.isAuthenticated():!0},this.addAuthIdentifier=function(e){return o?o.addAuthIdentifier(e):e},this.deauthorize=function(){o&&o.deauthorize()},this.getAjaxSettings=function(){return i},this.getRecordId=function(){return s}},e.Pipeline.adapters.Rest.prototype.read=function(n){var r=this,i=this.getRecordId(),s=this.getAjaxSettings(),o,u,a,f;return n=n||{},n[i]?o=s.url+"/"+n[i]:o=s.url,u=function(t){var r=n.stores?e.isArray(n.stores)?n.stores:[n.stores]:[],i;if(r.length)for(i in r)r[i].save(t,!0);n.success&&n.success.apply(this,arguments)},a=function(t,r){var i=n.stores?e.isArray(n.stores)?n.stores:[n.stores]:[],s;if(t==="auth"&&i.length)for(s in i)i[s].remove();n.error&&n.error.apply(this,arguments)},f={type:"GET",success:u,error:a,url:o,statusCode:n.statusCode,complete:n.complete},e.ajax(this,t.extend({},this.getAjaxSettings(),f))},e.Pipeline.adapters.Rest.prototype.save=function(n,r){var i=this,s=this.getRecordId(),o=this.getAjaxSettings(),u,a,f,l,c;return n=n||{},r=r||{},u=n[s]?"PUT":"POST",n[s]?a=o.url+"/"+n[s]:a=o.url,f=function(t){var n=e.isArray(r.stores)?r.stores:[r.stores],i;if(r.stores)for(i in n)n[i].save(t);r.success&&r.success.apply(this,arguments)},l=function(t,n){var i=r.stores?e.isArray(r.stores)?r.stores:[r.stores]:[],s;if(t==="auth"&&i.length)for(s in i)i[s].remove();r.error&&r.error.apply(this,arguments)},c={data:n,type:u,url:a,success:f,error:l,statusCode:r.statusCode,complete:r.complete},e.ajax(this,t.extend({},o,c))},e.Pipeline.adapters.Rest.prototype.remove=function(n,r){var i=this,s=this.getRecordId(),o=this.getAjaxSettings(),u="",a,f,l,c,h;return typeof n=="string"||typeof n=="number"?a=n:n&&n[s]?a=n[s]:n&&!r&&(r=n),r=r||{},u=a?"/"+a:"",f=o.url+u,l=function(t){var n,i;if(r.stores){n=e.isArray(r.stores)?r.stores:[r.stores];for(i in n)n[i].remove(a)}r.success&&r.success.apply(this,arguments)},c=function(t,n){var i=r.stores?e.isArray(r.stores)?r.stores:[r.stores]:[],s;if(t==="auth"&&i.length)for(s in i)i[s].remove();r.error&&r.error.apply(this,arguments)},h={type:"DELETE",url:f,success:l,error:c,statusCode:r.statusCode,complete:r.complete},e.ajax(this,t.extend({},o,h))}}(AeroGear,jQuery),function(e,t,n){e.Pipeline=function(t){if(!(this instanceof e.Pipeline))return new e.Pipeline(t);e.Core.call(this),this.lib="Pipeline",this.type=t?t.type||"Rest":"Rest",this.collectionName="pipes",this.add(t)},e.Pipeline.prototype=e.Core,e.Pipeline.constructor=e.Pipeline,e.Pipeline.adapters={}}(AeroGear,jQuery),function(e,t,n){e.ajax=function(n,r){var i=t.Deferred(function(){var i=this,s=t.extend({},{contentType:"application/json",dataType:"json"},r);this.done(s.success),this.fail(s.error),this.always(s.complete);var o=t.extend({},s,{success:function(e,t,n){i.resolve(typeof e=="string"&&o.dataType==="json"?JSON.parse(e):e,t,n)},error:function(e,t,n){if(o.dataType==="json")try{e.responseJSON=JSON.parse(e.responseText)}catch(r){}i.reject(e,t,n)},complete:function(e,t){i.resolve(e,t)}});o.contentType==="application/json"&&o.data&&(o.type==="POST"||o.type==="PUT")&&(o.data=JSON.stringify(o.data)),e.Auth&&!n.isAuthenticated()?this.reject("auth","Error: Authentication Required"):n.addAuthIdentifier?t.ajax(n.addAuthIdentifier(o)):t.ajax(o)}),s=i.promise();return s.success=i.done,s.error=i.fail,s.complete=i.always,s},e.isArray=function(e){return{}.toString.call(e)==="[object Array]"}}(AeroGear,jQuery);